doctype
html(class="dsc-html-" + collector)
  head
    meta(charset="utf-8")
    meta(http-equiv="X-UA-Compatible", content="IE=edge,chrome=1")
    meta(name="viewport", content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")
    meta(http-equiv="Content-type", content="text/html;charset=UTF-8")
    title= pageTitle

    script.
      window.atomatic = {
        packageName: '#{global.packageName}',
        packageVersion: '#{global.packageVersion}',
        collector: '#{collector}'
      };

    block appStyles

      include inlineFonts

      if app && app.cssFiles
        for href in app.cssFiles
          link(href=href, rel="stylesheet")

    block globalStyles
      if global && global.cssFiles
        for href in global.cssFiles
          link(href=href, rel="stylesheet")

    block globalScripts
      if global && global.jsFiles
        for src in global.jsFiles
          script(src=src, type="text/javascript")

    script.
      (function () {

        let listeningToBrowserSync = false;

        function listenToBrowserSync() {
          if (window.___browserSync___ && !listeningToBrowserSync) {
            ___browserSync___.socket.on('atomatic:reload', function () {
              console.warn('%cAtomatic reloading:', 'font-weight:bold', document.title, '\n' + window.location.href);
              window.location.reload();
            });
            listeningToBrowserSync = true;
          }
        }

        function delayedListenToBrowserSync() {
          setTimeout(listenToBrowserSync, 1000);
        }

        document.addEventListener('load', delayedListenToBrowserSync);
        document.addEventListener('DOMContentLoaded', delayedListenToBrowserSync);
      })();

  block body
